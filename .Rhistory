summary(df$Pickup_longitude)
load("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy/workspace.RData")
boxplot(df$Pickup_latitude)
df2$Pickup_latitude <- as.numeric(df$Pickup_latitude)
df2$Pickup_longitude <- as.numeric(df$Pickup_longitude)
df2$Dropoff_latitude <- as.numeric(df$Dropoff_latitude)
df2$Dropoff_longitude <- as.numeric(df$Dropoff_longitude)
boxplot(df$Pickup_latitude)
boxplot(df$Pickup_longitude)
boxplot(df$Dropoff_latitude)
boxplot(df$Dropoff_longitude)
boxplot(df$Trip_distance)
boxplot(df$Fare_amount)
boxplot(df$Extra)
boxplot(df$MTA_tax)
boxplot(df$Tip_amount)
boxplot(df$Tolls_amount)
boxplot(df$improvement_surcharge)
boxplot(df$Total_amount)
boxplot(df$Passenger_count)
hist(df$Pickup_latitude, main = NULL, xlab = NULL, ylab = NULL)
?boxplot
summary(df$Pickup_latitude)
df2$Pickup_latitude <- as.numeric(df$Pickup_latitude)
summary(df$Pickup_latitude)
df$Pickup_latitude <- as.numeric(df$Pickup_latitude)
df$Pickup_longitude <- as.numeric(df$Pickup_longitude)
df$Dropoff_latitude <- as.numeric(df$Dropoff_latitude)
df$Dropoff_longitude <- as.numeric(df$Dropoff_longitude)
boxplot(df$Trip_distance)
boxplot(df$Fare_amount)
boxplot(df$Extra)
boxplot(df$MTA_tax)
boxplot(df$Tip_amount)
hist(df$Tolls_amount, main = NULL, xlab = NULL, ylab = NULL)
hist(df$improvement_surcharge, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Total_amount, breaks = 40, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Passenger_count, main = NULL, xlab = NULL, ylab = NULL)
df$Pickup_latitude <- as.numeric(df$Pickup_latitude)
df$Pickup_longitude <- as.numeric(df$Pickup_longitude)
df$Dropoff_latitude <- as.numeric(df$Dropoff_latitude)
df$Dropoff_longitude <- as.numeric(df$Dropoff_longitude)
df$Trip_distance <- as.numeric(df$Trip_distance)
df$Fare_amount <- as.numeric(df$Fare_amount)
df$Extra <- as.numeric(df$Extra)
df$MTA_tax <- as.numeric(df$MTA_tax)
df$improvement_surcharge <- as.numeric(df$improvement_surcharge)
df$Total_amount <- as.numeric(df$Total_amount)
df$Passenger_count <- as.numeric(df$Passenger_count)
boxplot(df$Pickup_latitude)
boxplot(df$Pickup_longitude)
boxplot(df$Pickup_latitude)
boxplot(df$Pickup_longitude)
boxplot(df$Dropoff_latitude)
boxplot(df$Dropoff_longitude)
boxplot(df$Trip_distance)
boxplot(df$Fare_amount)
boxplot(df$Extra)
boxplot(df$Extra)
boxplot(df$MTA_tax)
boxplot(df$Tip_amount)
boxplot(df$improvement_surcharge)
boxplot(df$Total_amount)
boxplot(df$Passenger_count)
hist(df$Pickup_latitude, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Pickup_longitude, main = NULL, xlab = NULL, ylab = NULL)
boxplot(df$Dropoff_latitude)
hist(df$Dropoff_latitude, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Dropoff_longitude, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Trip_distance, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Fare_amount, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Extra, main = NULL, xlab = NULL, ylab = NULL)
hist(df$MTA_tax, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Tip_amount, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Tolls_amount, main = NULL, xlab = NULL, ylab = NULL)
hist(df$improvement_surcharge, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Total_amount, breaks = 40, main = NULL, xlab = NULL, ylab = NULL)
hist(df$Passenger_count, main = NULL, xlab = NULL, ylab = NULL)
save.image("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy/workspace.RData")
summary(df$MTA_tax)
boxplot(df$NAvalues)
hist(df$NAvalues, main = NULL, xlab = NULL, ylab = NULL)
summary(df$NAvalues)
?cov
load("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy/workspace.RData")
library(FactoMineR)
install.packages("FactoMineR")
library(FactoMineR)
?PCA
res.pca<-PCA(base,
quali.sup=c(1,2,16,17,18,19,20),quanti.sup= c(3:6,15,21,22))
res.pca<-PCA(,
quali.sup=c(1,2,16,17,18,19,20),quanti.sup= c(3:6,15,21,22))
res.pca<-PCA(df4,
quali.sup=c(1,2,16,17,18,19,20),quanti.sup= c(3:6,15,21,22))
rm(i)
rm(j)
rm(sel)
rm(vendorCounts)
rm(dropoffCounts)
rm(paytypeCounts)
rm(pickupCounts)
rm(ratecodeCounts)
rm(decoupe)
rm(storefwdCounts)
rm(triptypeCounts)
rm(dfNoRate)
dfNoQuantitatives <- df4
dfNoQuantitatives$RateCodeID <- NULL
dfNoQuantitatives$Tamount_inclass <- NULL
dfNoQuantitatives$Tip <- NULL
res.pca<-PCA(dfNoQuantitatives,
quali.sup=c(1,2,16,17,18,19,20),quanti.sup= c(3:6,15,21,22))
rm(dfNoQuantitatives)
colnames(df4)
colnames(df1)
colnames(df)
res.pca<-PCA(df4,
quali.sup=c(1,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16,))
colnames(df4)
res.pca<-PCA(df4,
quali.sup=c(1,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16))
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("ind"),invisible=c("ind"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("ind"),invisible=c("ind"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca)
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16))
names(res.pca)
summary(res.pca)
round(res.pca$eig,3)
barplot(res.pca$eig[,1],main="valores propios",names.arg=paste("dim",1:nrow(res.pca$eig)))
summary(res.pca)
sum(res.pca$eig[,1])
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("ind"),invisible=c("ind"))
?plot.PCA
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
plot.PCA(res.pca,choix=c("var"),invisible=c("var"))
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16))
plot.PCA(res.pca,choix=c("var"),invisible=c("quanti.sup"))
summary(res.pca)
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,22,23),quanti.sup= c(4:8,10,13,14,16))
colnames(df4)
df4$NAvalues <- NULL
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,21,22),quanti.sup= c(4:8,10,13,14,16))
names(res.pca$ind)
round(cbind(res.pca$ind$coord[,1:3],res.pca$ind$cos2[,1:3],res.pca$ind$contrib[,1:3]),2)
res.pca$ind$coord
rango<-order(res.pca$ind$coord[,1])
length(rango)
row.names(base)[rango[4660:4669]]
row.names(df4)[rango[4660:4669]]
row.names(bdf4)[rango[1:10]]
row.names(df4)[rango[1:10]]
df4[which(row.names(df4)=="1329730"),1:22]
df4[which(row.names(df4)=="363607"),1:22]
round(cbind(res.pca$var$coord[,1:3],res.pca$var$cos2[,1:3],res.pca$var$contrib[,1:3]),2)
round(cbind(res.pca$var$cos2[,1:4],res.pca$var$contrib[,1:4]),2)
dimdesc(res.pca)
dimdesc(res.pca)
plot.PCA(res.pca,choix=c("ind"),cex=0.8)
plot.PCA(res.pca,choix=c("ind"),invisible=c("quali"),axes=c(3,4))
plot.PCA(res.pca,choix=c("var"),axes=c(3,4))
plot.PCA(res.pca,choix=c("ind"),cex=0.8)
plot.PCA(res.pca,choix=c("ind"),invisible=c("quali"),axes=c(3,4))
plot.PCA(res.pca,choix=c("var"),axes=c(3,4))
round(cbind(res.pca$var$coord[,1:3],res.pca$var$cos2[,1:3],res.pca$var$contrib[,1:3]),2)
round(cbind(res.pca$var$cos2[,1:4],res.pca$var$contrib[,1:4]),2)
res.pca <- PCA(base,quanti.sup=c(2,13,15,18),quali.sup=c(16,17,19),ncp=4)
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,21,22, 23),quanti.sup= c(4:8,10,13,14,16), ncp=2, graph = FALSE)
library("FactoMineR", lib.loc="~/R/win-library/3.4")
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,21,22, 23),quanti.sup= c(4:8,10,13,14,16), ncp=2, graph = FALSE)
res.pca<-PCA(df4, quali.sup=c(1,2,3,17,18,19,20,21,22, 23),quanti.sup= c(4:8,10,13,14,16), ncp=2, graph = FALSE)
?HCPC
res.hcpc<-HCPC(res.pca,order=TRUE)
res.hcpc<-HCPC(res.pca,order=TRUE)
res.hcpc<-HCPC(res.pca,order=TRUE)
library("FactoMineR", lib.loc="~/R/win-library/3.4")
res.hcpc<-HCPC(res.pca,order=TRUE)
res.hcpc<-HCPC(res.pca,order=TRUE)
res.hcpc<-HCPC(res.pca,order=TRUE)
save.image("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy/workspace.RData")
(X <- matrix(c(1, 1, 1, 1, 1, -1, 1, 2, 3, 5, 1, 1, 4, 9, 25),nrow=5))
T <- c(2, 1, 1, 0, 3)
(C <- t(X) %*% X)  # X^T X
(X.pseudo <- solve(C) %*% t(X))  # (X^T X)^{-1} X^T
w <- X.pseudo %*% T
test <- X %*% w
?plot
points <- matrix(c(-1, 2, 1, 1, 2, 1, 3, 0, 5, 3),nrow=2)
plot(points)
rm(points)
xs <- c(-1, 1, 2, 3, 5)
ys <- c(2, 1, 1, 0, 3)
points(xs, ys)
plot(-6:6, -6:6, type = "n")
points(xs, ys)
w[0]
w[1]
w[2]
curve(w[1]+x*w[2]+x^2*w[3], from=-6, to=6, , xlab="x", ylab="y")
points(xs, ys)
plot(-6:6, -6:6, type = "n")
curve(w[1]+x*w[2]+x^2*w[3], from=-6, to=6, , xlab="x", ylab="y")
?curve
curve(w[1]+x*w[2]+x^2*w[3], from=-6, to=6, , xlab="x", ylab="y")
points(xs, ys)
colnames(df4)
res.pca<-PCA(df4,
quali.sup=c(),quanti.sup= c(9:15))
library("FactoMineR", lib.loc="~/R/win-library/3.4")
res.pca<-PCA(df4,
quali.sup=c(),quanti.sup= c(9:15))
res.pca<-PCA(df4,quanti.sup= c(9:15))
res.pca<-PCA(df4, quali.sup=c(21), quanti.sup= c(9:15))
res.pca<-PCA(df4, quali.sup=c(), quanti.sup= c(9:15))
res.pca<-PCA(df4, quali.sup=c(), quanti.sup= c(9:15))
View(df4)
View(df4)
summary(df4$Extra)
is.numeric(df4$Extra)
is.numeric(df4$MTA_tax)
is.numeric(df4$Tip_amount)
is.numeric(df4$Tolls_amount)
is.numeric(df4$improvement_surcharge)
is.numeric(df4$Fare_amount)
is.numeric(df4$Trip_distance)
colnames(df4)
res.pca<-PCA(df4, quali.sup=c(1), quanti.sup= c(9:15))
res.pca<-PCA(df4, quali.sup=c(9:15), quanti.sup= c(9:15))
?impute.pca
?imputePCA
?estim_ncp
install.packages("missMDA")
library("FactoMineR", lib.loc="~/R/win-library/3.4")
library("missMDA", lib.loc="~/R/win-library/3.4")
?imputePCA
res.comp = imputePCA(res.pca[, c(9:15)], ncp=2)
res.comp = imputePCA(df4[, c(9:15)], ncp=2)
colnames(res.comp)
df5<-df4
df5$Trip_distance<-res.comp$completeObs[,1]
df5$Fare_amount<-res.comp$completeObs[,2]
df5$Extra<-res.comp$completeObs[,3]
df5$MTA_tax<-res.comp$completeObs[,4]
df5$Tip_amount<-res.comp$completeObs[,5]
df5$Tolls_amount<-res.comp$completeObs[,6]
df5$improvement_surcharge<-res.comp$completeObs[,7]
res.pca<-PCA(df5, quali.sup=c(), quanti.sup= c(9:15))
marginalModelPlots(m25)
setwd("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy")
load("C:/Users/Gorka/Desktop/Uni/ADEI/ADEI-CaseStudy/.Rdata.RData")
requiredPackages <- c("effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2")
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
marginalModelPlots(m25)
requiredPackages <- c("effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2")
requiredPackages <- c("effects","FactoMineR","car", "factoextra","RColorBrewer","ggplot2")
missingPackages <- requiredPackages[!(requiredPackages %in% installed.packages()[,"Package"])]
if(length(missingPackages)) install.packages(missingPackages)
lapply(requiredPackages, require, character.only = TRUE)
m25<-lm(Total_amount~poly(tlenkm,2)+Extra+MTA_tax+Tip_amount+Tolls_amount,data=dfD4)
summary(m25)
anova(m24,m25)
library(car)
Anova(m25)
library(effects)
plot(allEffects(m25))
m25iii<-lm(Total_amount~tlenkm+I(tlenkm^2)+Extra+MTA_tax+Tip_amount+Tolls_amount,data=dfD4)
summary(m25iii)
marginalModelPlots(m25)
par(mfrow=c(2,2))
plot(m25)
par(mfrow=c(1,1))
library(MASS)
boxcox(m25,data=dfD4)
m26<-lm(log(Total_amount)~poly(tlenkm,2)+Extra+MTA_tax+Tip_amount+Tolls_amount,data=dfD4)
summary(m26)
Anova(m26)
par(mfrow=c(2,2))
plot(m26)
par(mfrow=c(1,1))
library(lmtest)
bptest(m26)  # Homocesdasticitat  REJECTED
qqq<-summary(rstudent(m26));qqq
sup<-qqq[5]+3*(qqq[5]-qqq[2]);sup
boxplot(rstudent(m26))
abline(h=sup,col="red",lwd=2)
abline(h=-sup,col="red",lwd=2)
llout<-which(abs(rstudent(m26))>5);length(llout) # Residual outliers
rstudent(m26)[llout]
dfD4[llout,vars_con]
llout<-which(abs(rstudent(m26))>5);length(llout) # Residual outliers
rstudent(m26)[llout]
quantile(hatvalues(m26),seq(0,1,0.1))
cuthat<-4*length(coef(m26))/nrow(dfD4);cuthat
Boxplot(hatvalues(m26))
abline(h=cuthat,col="blue",lwd=2,lty=2)
lllev<-which(hatvalues(m26)>0.02);length(lllev)
dfD4[lllev,vars_con]
Boxplot(cooks.distance(m26))
abline(h=0.05,col="green")
llcook<-which(cooks.distance(m26)>0.05);length(llcook)
dfD4[llcook,vars_con]
llcook<-which(cooks.distance(m26)>0.05);length(llcook)
dfD4[llcook,vars_con]
lllev<-which(hatvalues(m26)>0.02);length(lllev)
dfD4[lllev,vars_con]
Boxplot(cooks.distance(m26))
abline(h=0.05,col="green")
llcook<-which(cooks.distance(m26)>0.05);length(llcook)
dfD4[llcook,vars_con]
influenceIndexPlot(m26)
influencePlot(m26,col="orange",id.n=10)
dfbetas(m26)
dfbetas(m26)[1:10,]
matplot(dfbetas(m26),type="l")
nn<-dim(dfD4)[1]
abline(h=sqrt(4/nn),lty=3,col=6)
abline(h=-sqrt(4/nn),lty=3,col=6)
cex=2.0
legend(locator(n=1),legend=names(as.data.frame(dfbetas(m26))),col=c(1:7,1))
legend(locator(n=1),legend=names(as.data.frame(dfbetas(m26))),col=c(1:7,1))
lines(sqrt(cooks.distance(m26)),lwd=3,col=1)
legend(locator(n=1),legend=c(names(as.data.frame(dfbetas(m26))),"Cook D"), col=c(1:8,1))
matplot(dfbetas(m26),type="l")
marginalModelPlots(m26)
marginalModelPlots(m26)
marginalModelPlots(m26)
assignPeriod <- function(pickup)
if (pickup < 7 | pickup > 20) result <- "Night"
else if (pickup < 10) result <- "MorningPeak"
else if (pickup < 17) result <- "OffPeak"
else if (pickup < 21) result <- "OffPeak"
return(result)
assignPeriod <- function(pickup)
result <- "None"
if (pickup < 7 | pickup > 20) { result <- "Night"}
else if (pickup < 10) {result <- "MorningPeak"}
else if (pickup < 17) {result <- "OffPeak"}
else if (pickup < 21) result <- {"AfternoonPeak"}
return(result)
assignPeriod <- function(pickup)
result <- "None"
if (pickup < 7 | pickup > 20) { result <- "Night"}
else if (pickup < 10) {result <- "MorningPeak"}
else if (pickup < 17) {result <- "OffPeak"}
else if (pickup < 21) result <- {"AfternoonPeak"}
return(result)
assignPeriod <- function(pickup)
result <- "None"
if (pickup < 7 | pickup > 20) { result <- "Night"}
else if (pickup < 10) {result <- "MorningPeak"}
else if (pickup < 17) {result <- "OffPeak"}
else if (pickup < 21) result <- {"AfternoonPeak"}
return(result)
assignPeriod <- function(pickup)
result <- "None"
if (pickup < 7 | pickup > 20) { result <- "Night"}
else if (pickup < 10) {result <- "MorningPeak"}
else if (pickup < 17) {result <- "OffPeak"}
else if (pickup < 21) result <- {"AfternoonPeak"}
return(result)
assignPeriod <- function(pickup) {
result <- "None"
if (pickup < 7 | pickup > 20) { result <- "Night"}
else if (pickup < 10) {result <- "MorningPeak"}
else if (pickup < 17) {result <- "OffPeak"}
else if (pickup < 21) result <- {"AfternoonPeak"}
return(result)
}
dfProva$period <- assignPeriod(dfProva$pickup)
assignPeriod <- function(pickup) {
pickupN <- as.numeric(pickup)
result <- "None"
if (pickupN < 7 | pickupN > 20) { result <- "Night"}
else if (pickupN < 10) {result <- "MorningPeak"}
else if (pickupN < 17) {result <- "OffPeak"}
else if (pickupN < 21) result <- {"AfternoonPeak"}
return(result)
}
dfProva$period <- assignPeriod(dfProva$pickup)
assignPeriod <- function(pickup) {
pickupN <- as.numeric(pickup)
result <- "None"
if (pickupN < 7) { result <- "Night"}
else if (pickupN < 10) {result <- "MorningPeak"}
else if (pickupN < 17) {result <- "OffPeak"}
else if (pickupN < 21) result <- {"AfternoonPeak"}
else { result <- "Night"}
return(result)
}
dfProva$period <- assignPeriod(dfProva$pickup)
View(dfProva)
for (i in 1:5000) {
dfProva[i,]$period <- assignPeriod(dfProva[i,]$pickup)
}
View(dfProva)
assignPeriod <- function(pickup) {
pickupN <- as.numeric(pickup)
result <- "None"
if (pickupN < 8) { result <- "Night"}
else if (pickupN < 11) {result <- "MorningPeak"}
else if (pickupN < 18) {result <- "OffPeak"}
else if (pickupN < 22) result <- {"AfternoonPeak"}
else { result <- "Night"}
return(result)
}
for (i in 1:5000) {
dfProva[i,]$period <- assignPeriod(dfProva[i,]$pickup)
}
View(dfProva)
dfD4$period <- dfProva$period
m27<-lm(log(Total_amount)~poly(tlenkm,3)+Extra+MTA_tax+poly(Tip_amount,2)+Tolls_amount,data=dfD4)
anova(m24,m27)
summary(m27)
m241<-lm(log(Total_amount)~tlenkm+Extra+MTA_tax+Tip_amount+Tolls_amount,data=dfD4)
summary(m241)
m27<-lm(log(Total_amount)~poly(tlenkm,3)+Extra+MTA_tax+poly(Tip_amount,2)+Tolls_amount,data=dfD4)
anova(m241,m27)
summary(m27)
Anova(m27)
vif(m27)
plot(allEffects(m27))
plot(allEffects(m27))
plot(allEffects(m27))
table(dfD4$Extra)
table(dfD4$MTA_tax)
dfD4$f.extra<-0
dfD4$f.extra[dfD4$Extra>0]<-1
dfD4$f.extra[dfD4$Extra>0.5]<-2
dfD4$f.extra<-factor(dfD4$f.extra,labels=c("Extra-No","Extra-0.5","Extra-1"))
View(dfD4)
dfD4$f.MTA<-ifelse(dfD4$MTA_tax>0,1,0)
dfD4$f.MTA<-factor(dfD4$f.MTA,labels=c("TAX-No","TAX-Yes"))
m28<-lm(log(Total_amount)~poly(tlenkm,3)+f.extra+f.MTA+poly(Tip_amount,2)+Tolls_amount,data=dfD4)
summary(m28)
BIC(m27,m28)
```
names(dfD4)
vars_dis<-names(dfD4)[c(1,4,5,19:22,25:29)];vars_dis
m38<-lm(log(Total_amount)~poly(tlenkm,3)+Extra+MTA_tax+poly(Tip_amount,2)+Tolls_amount+RateCodeID+Payment_type+period+f.passcount+f.impro+VendorID,data=dfD4)
summary(m38)
Anova(m28, m38)
anova(m27,m37)  # Milloro moderadament Fisher Test
m37<-lm(log(Total_amount)~poly(tlenkm,3)+Extra+MTA_tax+poly(Tip_amount,2)+Tolls_amount+RateCodeID+Payment_type+f.hour+f.passcount+f.impro+VendorID,data=dfD4)
m39<-step(m38,k=log(nrow(dfD4)))  # I should use m38 (factor period, no hour)
Anova(m39)
vif(m39)  # Problems: remove one var
plot(allEffects(m39))
dfD4$period <- as.factor(dfProva$period)
plot(allEffects(m39))
m50<-lm(log(Total_amount) ~ poly(tlenkm, 3) +     poly(Tip_amount, 2)+ Extra + Tolls_amount + RateCodeID + Payment_type + period, data = dfD4)
m51<-lm(log(Total_amount) ~ ( poly(tlenkm, 3) +     poly(Tip_amount, 2)+ Extra + Tolls_amount)*period + (RateCodeID + Payment_type )* period, data = dfD4)
m52<-step(m51,k=log(nrow(dfD4)))
plot(allEffects(m52))
summary(m52)
Anova(m52)
vif(m52)
par(mfrow=c(2,2))
plot(m52,id.n=8)
par(mfrow=c(1,1))
llista<-influencePlot(m52,id.n=10);length(llista);llista
llrem<-which(row.names(dfD4)%in%row.names(llista));llrem
dfD41<-dfD4[-llrem,]
m61<-lm(log(Total_amount) ~ ( poly(tlenkm, 3) +     poly(Tip_amount, 2)+ Extra + Tolls_amount)*period + (RateCodeID + Payment_type )* period, data = dfD41)
m62<-step(m51,k=log(nrow(dfD41)))
summary(m62)
plot(m62,id.n=8)
vif(m24)  # No
